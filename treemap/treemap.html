<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treemap D3 Project for FCC</title>
    <link rel='stylesheet' type='text/css' href='../index.css' />
    <link href="https://fonts.googleapis.com/css?family=Dosis&display=swap" rel="stylesheet" />
</head>
<body>
    <nav> </nav>

    <main class="mainContent">
        <h1 id="title"></h1>
        <h4 id="description"></h4>
    </main>

    <footer></footer>

    <script src="https://d3js.org/d3.v4.min.js"></script> <!-- https://d3js.org/d3.v6.min.js  color functions not working with this verison -->
    
    <script>
        const getData = async (URL) => {
            try { 
                const data = await fetch(URL).then(response => response.json());
                const {name, children} = data;
                
                const w = 800; //of graph
                const h = 500;
                const padX = 4;
                const padY = 4;
                const padInner = 2;
                //const color = d3.scaleOrdinal().range(d3.schemeCategory20);
                
                const deltaHue = 25; 
                const colors = {};
                children.map((ele, i) => {
                    let factor = (i%2 === 0) ? 1 : 0; //for alternating hue, lightness, sat
                    let hue = (i%2 === 0) ? (i*deltaHue).toFixed(1) : (180 - deltaHue + i*deltaHue).toFixed(1);
                    let key = ele.name;
                    let val = `hsl(${hue}, ${35 + factor*55}%, ${50 + factor*35}%)`;
                    colors[key] = val;
                });

                const svg = d3.select('.mainContent')
                    .append('svg')
                    .attr('width', w + 2*padX)  //total svg size
                    .attr('height', h + 2*padY)
                    .style('background', 'black');

                const root = d3.hierarchy(data).sum(d => d.value);
                const treemap = d3.treemap().size([w,h]).paddingInner(padInner)(root);

                svg.selectAll('rect')
                    .data(root.leaves())
                    .enter()
                    .append('rect')
                    .attr('x', d => d.x0 + padX - padInner/2)
                    .attr('y', d => d.y0 + padY - padInner/2)
                    .attr('width', d => d.x1 - d.x0)
                    .attr('height', d => d.y1 - d.y0)
                    .style('fill', d => colors[d.data.category]); //colors[d.data.category] color(d.data.category)

            }
            catch(error){
                console.log(error);
            }
        }

        const URL = "https://cdn.freecodecamp.org/testable-projects-fcc/data/tree_map/video-game-sales-data.json";
        getData(URL);

    </script>
</body>
</html>